<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Bifurcations – MA32011</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./PythonAppendix.html" rel="next">
<link href="./1DFlows.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content=".">
<script src="site_libs/quarto-contrib/shinylive-0.10.7/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="site_libs/quarto-contrib/shinylive-0.10.7/shinylive/run-python-blocks.js" type="module"></script>
<link href="site_libs/quarto-contrib/shinylive-0.10.7/shinylive/shinylive.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/foldbox/foldbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>
.Corollary {
  --color1: #948bde;
  --color2: #584eab;
}
.Feature {
  --color1: #c0c0c0;
  --color2: #808080;
}
.DONE {
  --color1: #cce7b1;
  --color2: #86b754;
}
.Lemma {
  --color1: #948bde;
  --color2: #584eab;
}
.Conjecture {
  --color1: #948bde;
  --color2: #584eab;
}
.Definition {
  --color1: #d999d3;
  --color2: #a01793;
}
.Proof {
  --color1: #c0c0c0;
  --color2: #808080;
}
.Solution {
  --color1: #c0c0c0;
  --color2: #808080;
}
.TODO {
  --color1: #e7b1b4;
  --color2: #8c3236;
}
.Theorem {
  --color1: #948bde;
  --color2: #584eab;
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./1DFlows.html">1D flows</a></li><li class="breadcrumb-item"><a href="./Bifurcations.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bifurcations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MA32011</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/dundeemath/MA32011/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./MA32011.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">1D flows</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1DFlows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Flows on the line</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Bifurcations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bifurcations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PythonAppendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Python</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">3.1</span> Introduction</a></li>
  <li><a href="#saddle-node" id="toc-saddle-node" class="nav-link" data-scroll-target="#saddle-node"><span class="header-section-number">3.2</span> Saddle node</a></li>
  <li><a href="#transcritical" id="toc-transcritical" class="nav-link" data-scroll-target="#transcritical"><span class="header-section-number">3.3</span> Transcritical</a></li>
  <li><a href="#pitchfork" id="toc-pitchfork" class="nav-link" data-scroll-target="#pitchfork"><span class="header-section-number">3.4</span> Pitchfork</a>
  <ul class="collapse">
  <li><a href="#supercritical-pitchfork" id="toc-supercritical-pitchfork" class="nav-link" data-scroll-target="#supercritical-pitchfork"><span class="header-section-number">3.4.1</span> Supercritical pitchfork</a></li>
  <li><a href="#subcritical-pitchfork" id="toc-subcritical-pitchfork" class="nav-link" data-scroll-target="#subcritical-pitchfork"><span class="header-section-number">3.4.2</span> Subcritical pitchfork</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/dundeemath/MA32011/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./1DFlows.html">1D flows</a></li><li class="breadcrumb-item"><a href="./Bifurcations.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bifurcations</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Bifurcations</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">3.1</span> Introduction</h2>
<p>The qualitative behaviour of solutions of <span class="math display">\[
\dot{x}=f(x), \quad  x(0)=x_0
\]</span></p>
<p>are limited. Solutions either <em>flow</em> to a fixed point, remain at a fixed point or tend to <span class="math inline">\(\pm \infty\)</span>. So what is interesting about the study of such problems?</p>
<p>Now we introduce the idea of bifurcations. These arise when the structure of the solutions (i.e.&nbsp;the number and/or stability of fixed points) changes at particular parameter values.</p>
<p>At a bifurcation point of a 1D system the eigenvalue is 0. Hence the fixed point is <em>not</em> hyperbolic.</p>
<p>Consider the 1D system <span class="math display">\[
\dot{x}=f(x,r)
\]</span> where <span class="math inline">\(r\)</span> is a parameter.</p>
<p>Suppose that</p>
<ul>
<li>there is a fixed point <span class="math inline">\(x=x^*\)</span>.</li>
<li>at some <span class="math inline">\(r=r_c\)</span> the eigenvalue of the linearised system vanishes.</li>
</ul>
<p>Upon Taylor expansion of <span class="math inline">\(f\)</span> about <span class="math inline">\((x^*,r_c)\)</span>, we obtain <span class="math display">\[
\dot{x}=f(x^*,r_c)+\frac{\partial f}{\partial x}_{(x^*,r_c)}(x-x^*) + \frac{\partial f}{\partial r}_{(x^*,r_c)}(r-r_c)
+ \frac{1}{2}(x-x_c)^2\frac{\partial^2 f}{\partial x^2}_{(x^*,r_c)}  + ... \]</span></p>
<p>As <span class="math inline">\(x^*\)</span> is a fixed point</p>
<p><span class="math display">\[
\dot{x}= \frac{\partial f}{\partial r}_{(x^*,r_c)}(r-r_c)
+ \frac{1}{2}(x-x^*)^2\frac{\partial^2 f}{\partial x^2}_{(x^*,r_c)}  +\frac{1}{2}(r-r_c)^2\frac{\partial^2 f}{\partial r^2}_{(x^*,r_c)} +(r-r_c)(x-x^*)\frac{\partial^2 f}{\partial r \partial x}_{(x^*,r_c)}  ... \]</span></p>
<p>Close to a bifurcation point, the stability classification will be determined by the higher order derivatives of <span class="math inline">\(f\)</span> w.r.t. <span class="math inline">\(x\)</span> and <span class="math inline">\(r\)</span>.</p>
<p>It can be shown that bifurcations of the systems <span class="math display">\[
\dot{x}=f(x,r), \quad x(0)=x_0
\]</span> can be reduced to one of three <em>normal forms</em>:</p>
<ul>
<li>saddle node bifurcations</li>
<li>transcritical bifurcations</li>
<li>pitchfork bifurcations</li>
</ul>
</section>
<section id="saddle-node" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="saddle-node"><span class="header-section-number">3.2</span> Saddle node</h2>
<p>At a saddle node bifurcation, two fixed points move towards one another and mutually annihilate. The canonical form is given by</p>
<p><span id="eq-saddlenode1d"><span class="math display">\[
\dot{x}=f(x,r)=r+x^2,
\tag{3.1}\]</span></span> where <span class="math inline">\(r \in \Re\)</span>.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.1</strong></span> Identify the fixed points of <a href="#eq-saddlenode1d" class="quarto-xref">Equation&nbsp;<span>3.1</span></a> and determine their linear stability.</p>
</div>
<div id="Solution*-1" class="Solution">
<p></p><details class="Solution fbx-default closebutton"><summary><strong>Solution</strong></summary><div>The fixed points are <span class="math display">\[
x^*_{\pm}=\pm \sqrt{-r}.
\]</span><p></p>
<p>In the case <span class="math inline">\(r&lt;0\)</span></p>
<p><span class="math display">\[
f'(x^*)=\pm 2\sqrt{-r}.
\]</span></p>
<p>Hence <span class="math inline">\(x^*_-\)</span> is linearly stable and <span class="math inline">\(x^*_+\)</span> is linearly unstable.</p>
<p>For <span class="math inline">\(r=0\)</span> the fixed point is <em>half-stable</em> and it vanishes for <span class="math inline">\(r&gt;0\)</span>. Upon plotting <span class="math inline">\(x^*\)</span> against <span class="math inline">\(r\)</span> we obtain a bifurcation diagram.</p>
</div></details>
</div>
<p>In <a href="#fig-fsaddlenode" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> we plot <span class="math inline">\(f\)</span> at three different values of <span class="math inline">\(r\)</span>. Note that when <span class="math inline">\(r&gt;0\)</span>, <span class="math inline">\(f&gt;0\)</span> and the solution is an increasing function of time.</p>
<p>At <span class="math inline">\(r=0\)</span> there is a double root of <span class="math inline">\(f\)</span>. Here the fixed point is <em>half stable</em>. For the initial condition <span class="math inline">\(x_0&lt;0\)</span> the solution will increase until <span class="math inline">\(x(t=0)\)</span>. It is stable to perturbations along the negative <span class="math inline">\(x\)</span> axis. However, for <span class="math inline">\(x_0&gt;0\)</span> <span class="math inline">\(f&gt;0\)</span> and the solution is an increasing function of time. Hence the solution is unstable to perturbations with <span class="math inline">\(x_0&gt;0\)</span>. Hence the fixed point <span class="math inline">\(x^*=0\)</span> is defined to be half-stable when <span class="math inline">\(r=0\)</span>.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.linspace(<span class="op">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>r_vec<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span>,<span class="fl">0.0</span>,<span class="fl">1.0</span>]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>ax.flatten()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,r_i <span class="kw">in</span> <span class="bu">enumerate</span>(r_vec):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>r_i<span class="op">+</span>x<span class="op">**</span><span class="dv">2</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(x,f)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    r<span class="op">=</span>r_i</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>     <span class="co"># ---- fixed points ----</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    fixed_points <span class="op">=</span> []</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        fixed_points <span class="op">+=</span> [np.sqrt(<span class="op">-</span>r), <span class="op">-</span>np.sqrt(<span class="op">-</span>r)]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x_fp <span class="kw">in</span> fixed_points:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span>  <span class="dv">2</span> <span class="op">*</span> x_fp   <span class="co"># derivative at fixed point</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df <span class="op">&lt;</span> <span class="dv">0</span>:   <span class="co"># stable</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            ax[i].plot(x_fp, <span class="dv">0</span>, <span class="st">'ko'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:        <span class="co"># unstable</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            ax[i].plot(x_fp, <span class="dv">0</span>, <span class="st">'ko'</span>, markerfacecolor<span class="op">=</span><span class="st">'white'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    ax[i].axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    ax[i].axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"r = </span><span class="sc">{</span>r<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    x_arrows <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">1.8</span>, <span class="fl">1.8</span>, <span class="dv">6</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    f_arrows <span class="op">=</span> r<span class="op">+</span>x_arrows<span class="op">**</span><span class="dv">2</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> xa, fa <span class="kw">in</span> <span class="bu">zip</span>(x_arrows, f_arrows):</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">abs</span>(fa) <span class="op">&lt;</span> <span class="fl">1e-6</span>:</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> np.sign(fa)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        ax[i].arrow(</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            xa, <span class="dv">0</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.12</span> <span class="op">*</span> direction, <span class="dv">0</span>,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>            head_width<span class="op">=</span><span class="fl">0.08</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            head_length<span class="op">=</span><span class="fl">0.16</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            fc<span class="op">=</span><span class="st">'k'</span>, ec<span class="op">=</span><span class="st">'k'</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>            length_includes_head<span class="op">=</span><span class="va">True</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    fig.supxlabel(<span class="st">'$x$'</span>)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    fig.supylabel(<span class="st">'$</span><span class="er">\</span><span class="st">dot</span><span class="sc">{x}</span><span class="st">$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-fsaddlenode" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fsaddlenode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="b3b49d4f" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bifurcations_files/figure-html/cell-2-output-1.png" width="611" height="457" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-fsaddlenode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1
</figcaption>
</figure>
</div>
<p>In <a href="#fig-saddlenodebfc" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> we plot the fixed points against the parameter <span class="math inline">\(r\)</span>. For <span class="math inline">\(r&lt;0\)</span> there are two fixed points (<span class="math inline">\(\sqrt{r}\)</span> is linearly unstable whilst <span class="math inline">\(-\sqrt{r}\)</span> is linearly stable). Usually some annotation is used to denote the stability. For <span class="math inline">\(r&gt;0\)</span> there are no fixed points.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">400</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed points</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> np.zeros_like(r)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>x_plus <span class="op">=</span> np.full_like(r, np.nan)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>x_minus <span class="op">=</span> np.full_like(r, np.nan)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> r <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>x_plus[mask] <span class="op">=</span> np.sqrt(r[mask])</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>x_minus[mask] <span class="op">=</span> <span class="op">-</span>np.sqrt(r[mask])</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># unstable branch x = 0 for r &gt; 0</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># stable branches ±sqrt(r)</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>ax.plot(<span class="op">-</span>r, x_plus, <span class="st">'k--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>ax.plot(<span class="op">-</span>r, x_minus, <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"$r$"</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"$x*$"</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>ax.set_xlim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-saddlenodebfc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-saddlenodebfc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="b68c88d0" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bifurcations_files/figure-html/cell-3-output-1.png" width="565" height="468" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-saddlenodebfc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2
</figcaption>
</figure>
</div>
<p>With the app below you can explore how the value of the parameter value <span class="math inline">\(r\)</span> affects system dynamics.</p>
<p>The app computes solutions to <span class="math display">\[
\dot{x}=r+x^2, \quad x(0)=x_0, \quad t \in[0,T].
\]</span></p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 800
#| label: fig-saddlenode


from shiny import App, Inputs, Outputs, Session, render, ui
from shiny import reactive

import numpy as np
from pathlib import Path
import matplotlib.pyplot as plt
from scipy.integrate import odeint

app_ui = ui.page_fluid(
                 
    ui.input_slider(id="u0",label="x_0 (Init. Cond.)",min=-1.0,max=1.0,value=0.5,step=0.01),
    ui.input_slider(id="T",label="T (Time)",min=0.1,max=60.0,value=20.0,step=1.0),
    ui.input_slider(id="r",label="r",min=-1.0,max=1.0,value=0.1,step=0.01),
    ui.output_plot("plot"),

)

def server(input, output, session):
    @output
    @render.plot
    def plot():
        fig, ax = plt.subplots(3,1,figsize=(12, 4))
        #ax.set_ylim([-2, 2])
        #         
        r=float(input.r())
        u0=float(input.u0())
        T=int(input.T())

        if r&gt;0:
            T=1/np.sqrt(r)*(np.pi/2.0-np.arctan(u0/np.sqrt(r)))
        elif (r&lt;0):
            if u0&gt;np.sqrt(-r):
                T=1/np.sqrt(-r)*(np.pi/2.0-np.arctan(u0/np.sqrt(-r)))
        else:
            T=1/u0
        

        # Define rhs of bfc ODE 
        def saddle_node_bfc_rhs(y,t,r):
          rhs=r+y**2.0
          return rhs
        
        def ODESol(saddle_node_bfc_rhs,y_0,t,r):
            y=np.zeros_like(t,dtype=float)
            init_cond=y_0

            
            sol1 = odeint(saddle_node_bfc_rhs, init_cond,t,args=(r,))
            return sol1
            
        # Define discretised t domain
        t = np.linspace(0, T)
        # define initial conditions
        init_cond=u0
        
        ax[0].set_xlabel('$t$')
        ax[0].set_ylabel('$x(t)$')

        plt.grid()
        
        # Compute numerical solution of ODEs
        sol1 = ODESol(saddle_node_bfc_rhs,init_cond,t,r)

        # Plot results
        x=sol1
        
        ax[0].plot(t,x)
        ax[0].set_xlabel('$t$')
        ax[0].set_ylabel('$x$')
        ax[0].set_ylim([-3,3])
        ax[0].set_title('Numerical solution')

        r_values = np.linspace(-2.0, 2.0, 1000)  # range of r values
        
        x=np.sqrt(r_values)

        ax[1].plot(-r_values,x,'k--',-r_values,-x,'k')
        ax[1].set_xlabel('$r$')
        ax[1].set_ylabel('$x^*$')
        ax[1].set_xlim([-3,3])
        ax[1].set_title('Bifurcation diagram')
        ax[1].plot([r,r],[-3,3],'--')


        x_plot=np.linspace(-3,3)
        f=saddle_node_bfc_rhs(x_plot,0,r)
        ax[2].plot(x_plot,f)
        ax[2].set_xlabel('$x$')
        ax[2].set_ylabel('$f$')
        ax[2].set_ylim([-2,2])
        ax[2].plot([u0,u0],[-2,2],'--')

        ax[2].set_title('Phase portrait')
        


        
app = App(app_ui, server)</code></pre>
<p>An app to exploring behaviour of the saddle-node bifurcation.</p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.2</strong></span> Consider the following ODE: <span class="math display">\[
\dot{x}=1+rx+x^2, \quad x(0)=x_0.
\]</span></p>
<ol type="1">
<li>Sketch the bifurcation diagram.</li>
<li>Show that upon introducing rescaled variables, the ODE can be written in the normal form <span class="math display">\[
\dot{y}=r'+y^2.
\]</span> Hint: try completing the square.</li>
</ol>
</div>
<!--Note that a saddle-node bifurcation is defined by a tangency condition such that 
$$
\frac{\partial f}{\partial x}_{(x^*,r_c)}.
$$

Hence the normal form is 
$$
\dot{x}= \frac{\partial f}{\partial r}_{(x^*,r_c)}(r-r_c)
+ \frac{1}{2}(x-x_c)^2\frac{\partial^2 f}{\partial x^2}_{(x^*,r_c)} 
$$
i.e. the right-hand side is linear in $r$ and quadratic in $x$.
-->
</section>
<section id="transcritical" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="transcritical"><span class="header-section-number">3.3</span> Transcritical</h2>
<p>At a transcritical bifurcation the stability of a fixed point changes as a parameter is varied. However, fixed points do not <em>disappear</em>, as was the case with the saddle node bifurcation.</p>
<p>The <em>normal form</em> for a transcritical bifurcation is</p>
<p><span class="math display">\[
\dot{x}=rx-x^2,
\]</span></p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.3</strong></span> Identify the fixed points and their linear stability</p>
</div>
<div id="Solution*-2" class="Solution">
<p></p><details class="Solution fbx-default closebutton"><summary><strong>Solution</strong></summary><div>The fixed points are <span class="math inline">\(x^*=0\)</span> and <span class="math inline">\(x^*=r\)</span>. For <span class="math inline">\(r&lt;0\)</span>, <span class="math inline">\(x^*=r\)</span> is linearly unstable and <span class="math inline">\(x^*=0\)</span> is linearly stable. At <span class="math inline">\(r=0\)</span> the fixed points coalesce and the fixed point is half stable. For <span class="math inline">\(r&gt;0\)</span> <span class="math inline">\(x^*=0\)</span> is linearly unstable and <span class="math inline">\(x^*=r\)</span> is linearly stable.<p></p>
</div></details>
</div>
<p>In <a href="#fig-transcritf" class="quarto-xref">Figure&nbsp;<span>3.3</span></a> the function <span class="math inline">\(f\)</span> is plotted for different values of the parameter <span class="math inline">\(r\)</span>. The origin is always a fixed point. For <span class="math inline">\(r&lt;0\)</span> there is a fixed point on the negative real axis whilst for <span class="math inline">\(r&gt;0\)</span> there is a fixed point on the positive real axis. Hence the number of fixed points is two for <span class="math inline">\(|r|&gt;0\)</span>. This bifurcation is fundamentally different to the saddle node bifurcation (where there are no fixed points on one side of the bifurcation).</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.linspace(<span class="op">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>r_vec<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span>,<span class="fl">0.0</span>,<span class="fl">1.0</span>]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>ax.flatten()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,r_i <span class="kw">in</span> <span class="bu">enumerate</span>(r_vec):</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>r_i<span class="op">*</span>x<span class="op">-</span>x<span class="op">**</span><span class="dv">2</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(x,f)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    r<span class="op">=</span>r_i</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>     <span class="co"># ---- fixed points ----</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    fixed_points <span class="op">=</span> [<span class="fl">0.0</span>]</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        fixed_points <span class="op">+=</span> [<span class="dv">0</span>,r]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> r<span class="op">&lt;</span><span class="dv">0</span>:</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        fixed_points <span class="op">+=</span> [r,<span class="dv">0</span>]</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x_fp <span class="kw">in</span> fixed_points:</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> r <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> x_fp   <span class="co"># derivative at fixed point</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df <span class="op">&lt;</span> <span class="dv">0</span>:   <span class="co"># stable</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            ax[i].plot(x_fp, <span class="dv">0</span>, <span class="st">'ko'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:        <span class="co"># unstable</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            ax[i].plot(x_fp, <span class="dv">0</span>, <span class="st">'ko'</span>, markerfacecolor<span class="op">=</span><span class="st">'white'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    ax[i].axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    ax[i].axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"r = </span><span class="sc">{</span>r<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    x_arrows <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">1.8</span>, <span class="fl">1.8</span>, <span class="dv">6</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    f_arrows <span class="op">=</span> r <span class="op">*</span> x_arrows <span class="op">-</span> x_arrows<span class="op">**</span><span class="dv">2</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> xa, fa <span class="kw">in</span> <span class="bu">zip</span>(x_arrows, f_arrows):</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">abs</span>(fa) <span class="op">&lt;</span> <span class="fl">1e-3</span>:</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> np.sign(fa)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        ax[i].arrow(</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            xa, <span class="dv">0</span>,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.12</span> <span class="op">*</span> direction, <span class="dv">0</span>,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            head_width<span class="op">=</span><span class="fl">0.08</span>,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>            head_length<span class="op">=</span><span class="fl">0.08</span>,</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>            fc<span class="op">=</span><span class="st">'k'</span>, ec<span class="op">=</span><span class="st">'k'</span>,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>            length_includes_head<span class="op">=</span><span class="va">True</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    fig.supxlabel(<span class="st">'$x$'</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    fig.supylabel(<span class="st">'$</span><span class="er">\</span><span class="st">dot</span><span class="sc">{x}</span><span class="st">$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-transcritf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-transcritf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="7a145ab0" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bifurcations_files/figure-html/cell-4-output-1.png" width="611" height="457" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-transcritf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3
</figcaption>
</figure>
</div>
<p>In <a href="#fig-transcritbfc" class="quarto-xref">Figure&nbsp;<span>3.4</span></a> we plot a bifurcation diagram for the transcritical bifurcation. Note that <span class="math inline">\(x^*=0\)</span> is always a fixed points but it’s stability changes at <span class="math inline">\(r=0\)</span>.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">400</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed points</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> np.zeros_like(r)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>x_plus <span class="op">=</span> np.full_like(r, np.nan)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>x_minus <span class="op">=</span> np.full_like(r, np.nan)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> r <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>x_plus[mask] <span class="op">=</span> (r[mask])</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>x_minus[mask] <span class="op">=</span> (r[mask])</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># unstable branch x = 0 for r &gt; 0</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>ax.plot(r[r <span class="op">&gt;</span> <span class="dv">0</span>], x0[r <span class="op">&gt;</span> <span class="dv">0</span>], <span class="st">'k--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>ax.plot(r[r <span class="op">&lt;</span> <span class="dv">0</span>], r[r <span class="op">&lt;</span> <span class="dv">0</span>], <span class="st">'k--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># stable branch x = 0 for r &lt; 0</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>ax.plot(r[r <span class="op">&lt;</span> <span class="dv">0</span>], x0[r <span class="op">&lt;</span> <span class="dv">0</span>], <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># stable branches ±sqrt(r)</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>ax.plot(r, x_plus, <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>ax.plot(r, x_minus, <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"$r$"</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"$x*$"</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-transcritbfc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-transcritbfc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="63329501" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bifurcations_files/figure-html/cell-5-output-1.png" width="565" height="468" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-transcritbfc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4
</figcaption>
</figure>
</div>
<p>With the app below you can explore how the value of the parameter value <span class="math inline">\(r\)</span> affects system dynamics for the transcritical bifurcation.</p>
<p>The app computes solutions to <span class="math display">\[
\dot{x}=rx-x^2, \quad x(0)=x_0, \quad t \in[0,T].
\]</span></p>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 800
#| label: fig-transcrit


from shiny import App, Inputs, Outputs, Session, render, ui
from shiny import reactive

import numpy as np
from pathlib import Path
import matplotlib.pyplot as plt
from scipy.integrate import odeint
from scipy.integrate import solve_ivp

app_ui = ui.page_fluid(
                 
    ui.input_slider(id="u0",label="x_0 (Init. Cond.)",min=-3.0,max=3.0,value=0.5,step=0.01),
    ui.input_slider(id="T",label="T (Time)",min=0.1,max=60.0,value=20.0,step=1.0),
    ui.input_slider(id="r",label="r",min=-2.0,max=2.0,value=0.1,step=0.1),
    ui.output_plot("plot"),

)

def server(input, output, session):
    @output
    @render.plot
    def plot():
        fig, ax = plt.subplots(3,1,figsize=(12, 4))
        #ax.set_ylim([-2, 2])
        #         
        r=float(input.r())
        u0=float(input.u0())
        T=int(input.T())
    
        
        # Define rhs of bfc ODE 
        def saddle_node_bfc_rhs(t,y,r):
          rhs=r*y-y**2
          return rhs
        def stop_event(t, y,r):
            return np.abs(y[0]-10)          # trigger when y[0] == 0

        
        def ODESol(saddle_node_bfc_rhs,y_0,T,r):
            #y=np.zeros_like(t,dtype=float)
            init_cond=y_0

            stop_event.terminal = True   # STOP integration
            stop_event.direction = 1   # only trigger when crossing downward

            sol1 = solve_ivp(saddle_node_bfc_rhs,t_span=(0, T),y0=[init_cond],
                events=stop_event,args=(r,)
            )
            return sol1
            
        # Define discretised t domain
        # define initial conditions
        init_cond=u0
        
        ax[0].set_xlabel('$t$')
        ax[0].set_ylabel('$x(t)$')

        plt.grid()
        
        # Compute numerical solution of ODEs
        sol1 = ODESol(saddle_node_bfc_rhs,init_cond,T,r)
        
        ax[0].plot(sol1.t,sol1.y[0])
        ax[0].set_xlabel('$t$')
        ax[0].set_ylabel('$x$')
        ax[0].set_ylim([-10,10])
        ax[0].set_title('Numerical solution')

        
        r_values = np.linspace(-2.0, 2.0, 1000)  # range of r values
        
        x_1=np.zeros_like(r_values)
        x_2=r_values

        ax[1].plot(r_values[r_values&lt;0],x_1[r_values&lt;0],'k',r_values[r_values&lt;0],x_2[r_values&lt;0],'k--')
        ax[1].plot(r_values[r_values&gt;0],x_1[r_values&gt;0],'k--',r_values[r_values&gt;0],x_2[r_values&gt;0],'k')
        ax[1].set_xlabel('$r$')
        ax[1].set_ylabel('$x^*$')
        ax[1].set_xlim([-3,3])
        ax[1].set_title('Bifurcation diagram')
        ax[1].plot([r,r],[-3,3],'--')

        
        x_plot=np.linspace(-3,3)
        f=saddle_node_bfc_rhs(0,x_plot,r)
        ax[2].plot(x_plot,f)
        ax[2].set_xlabel('$x$')
        ax[2].set_ylabel('$f$')
        ax[2].set_ylim([-2,2])
        ax[2].plot([u0,u0],[-2,2],'--')

        ax[2].set_title('Phase portrait')

        x_arrows = np.linspace(-1.8, 1.8, 6)
        f_arrows = r * x_arrows - x_arrows**2

        for xa, fa in zip(x_arrows, f_arrows):
            if abs(fa) &lt; 1e-3:
                continue
            direction = np.sign(fa)
            ax[2].arrow(
                xa, 0,
                0.12 * direction, 0,
                head_width=0.2,
                head_length=0.28,
                fc='k', ec='k',
                length_includes_head=True
            )
        
                
app = App(app_ui, server)</code></pre>
<p>An app for exploring behaviour of the transcritical bifurcation.</p>
<!--
For a transcritical bifurcation

$$
\frac{\partial f}{\partial x}_{(x^*,r_c)}=0, \quad  \frac{\partial f}{\partial r}_{(x^*,r_c)}=0
$$

and the leading order terms are given by

$$
\dot{x}= 
\frac{1}{2}(x-x^*)^2\frac{\partial^2 f}{\partial x^2}_{(x^*,r_c)} +(r-r_c)(x-x^*)\frac{\partial^2 f}{\partial r \partial x}_{(x^*,r_c)} 
$$
-->
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.4</strong></span> Sketch the bifurcation diagram for</p>
<p><span class="math display">\[
\dot{x}=rx+x^2.
\]</span></p>
</div>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.5</strong></span> Consider the ODE</p>
<p><span class="math display">\[
\dot{x}=r\ln x + x-1.
\]</span></p>
<ol type="1">
<li>Show that <span class="math inline">\(x^*=1\)</span> is a fixed point.</li>
<li>Make a change of variables <span class="math inline">\(u=x-1\)</span> in order to analyse perturbations about the fixed point.</li>
<li>Use a Taylor expansion to show that this system can be approximated by the transcritical normal form. Hence deduce that the bifurcation vaue is <span class="math inline">\(r=-1\)</span>.</li>
<li>Show that the system can be reduced to the normal form <span class="math display">\[
\dot{X}=RX-X^2
\]</span> by making an appropriate change of variables.</li>
</ol>
</div>
</section>
<section id="pitchfork" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="pitchfork"><span class="header-section-number">3.4</span> Pitchfork</h2>
<p>Pitchfork bifurcations often arise in situations with symmetry. Typically, two or more fixed points appear/disappear together.</p>
<section id="supercritical-pitchfork" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="supercritical-pitchfork"><span class="header-section-number">3.4.1</span> Supercritical pitchfork</h3>
<p>The normal form of the supercritical pitchfork bifurcation is <span class="math display">\[
\dot{x}=rx-x^3,
\]</span></p>
<div id="exm-" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.6</strong></span> Identify the fixed points and determine their linear stability</p>
</div>
<div id="Solution*-3" class="Solution">
<p></p><details class="Solution fbx-default closebutton"><summary><strong>Solution</strong></summary><div>The fixed points satisfy <span class="math display">\[
rx^*-{x^*}^3=0
\]</span><p></p>
<p>Hence <span class="math inline">\(x^*\)</span> is a fixed point. Other fixed points satisfy <span class="math display">\[
r-{x^*}^2=0
\]</span></p>
<p>Hence there is a pair of fixed points given by <span class="math display">\[
x^*= \pm \sqrt{r},
\]</span> defined for <span class="math inline">\(r&gt;0\)</span>.</p>
<p>For <span class="math display">\[
f(x,r)=rx-x^3
\]</span> differentiation yields <span class="math display">\[
f'(x)=r-3x^2.
\]</span></p>
<p>At <span class="math inline">\(x^*=0\)</span></p>
<p><span class="math display">\[
f'(0)=r.
\]</span></p>
<p>For <span class="math inline">\(r&lt;0\)</span>, <span class="math inline">\(x^*=0\)</span> is linearly stable. For <span class="math inline">\(r&gt;0\)</span>, <span class="math inline">\(x^*=0\)</span> is linearly unstable. There is a bifurcation at <span class="math inline">\(r=0\)</span>.</p>
<p>At <span class="math inline">\(x^*= \pm \sqrt{r}\)</span></p>
<p><span class="math display">\[
f'(\pm \sqrt{r})=r-3r=-2r.
\]</span></p>
<p>Hence when real, non-trivial fixed points exist <span class="math inline">\(r&gt;0\)</span> they are linearly stable.</p>
<p>At <span class="math inline">\(r=0\)</span> the fixed points coalesce and the fixed point is half stable.</p>
</div></details>
</div>
<p>In <a href="#fig-supcritf" class="quarto-xref">Figure&nbsp;<span>3.5</span></a> we plot <span class="math inline">\(f\)</span> for three different values of <span class="math inline">\(r\)</span>. For <span class="math inline">\(r&lt;0\)</span> it is clear that <span class="math inline">\(x^*=0\)</span> is a uniquye fixed point and that it is linearly stable. For <span class="math inline">\(r&gt;0\)</span> <span class="math inline">\(f\)</span> is a cubic with three real roots. Note that the non-zero roots are linearly stable and symmetrically distributed about the origin. We refer to a system with two linearly stable fixd points as being <em>bistable</em>.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.linspace(<span class="op">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>r_vec<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span>,<span class="fl">0.0</span>,<span class="fl">1.0</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>ax.flatten()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,r_i <span class="kw">in</span> <span class="bu">enumerate</span>(r_vec):</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>r_i<span class="op">*</span>x<span class="op">-</span>x<span class="op">**</span><span class="dv">3</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(x,f)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    r<span class="op">=</span>r_i</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>     <span class="co"># ---- fixed points ----</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    fixed_points <span class="op">=</span> [<span class="fl">0.0</span>]</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        fixed_points <span class="op">+=</span> [np.sqrt(r), <span class="op">-</span>np.sqrt(r)]</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x_fp <span class="kw">in</span> fixed_points:</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> r <span class="op">-</span> <span class="dv">3</span> <span class="op">*</span> x_fp<span class="op">**</span><span class="dv">2</span>   <span class="co"># derivative at fixed point</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df <span class="op">&lt;</span> <span class="dv">0</span>:   <span class="co"># stable</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            ax[i].plot(x_fp, <span class="dv">0</span>, <span class="st">'ko'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:        <span class="co"># unstable</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            ax[i].plot(x_fp, <span class="dv">0</span>, <span class="st">'ko'</span>, markerfacecolor<span class="op">=</span><span class="st">'white'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    ax[i].axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    ax[i].axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"r = </span><span class="sc">{</span>r<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    x_arrows <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">1.8</span>, <span class="fl">1.8</span>, <span class="dv">6</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    f_arrows <span class="op">=</span> r <span class="op">*</span> x_arrows <span class="op">-</span> x_arrows<span class="op">**</span><span class="dv">3</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> xa, fa <span class="kw">in</span> <span class="bu">zip</span>(x_arrows, f_arrows):</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">abs</span>(fa) <span class="op">&lt;</span> <span class="fl">1e-3</span>:</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> np.sign(fa)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        ax[i].arrow(</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>            xa, <span class="dv">0</span>,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.12</span> <span class="op">*</span> direction, <span class="dv">0</span>,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>            head_width<span class="op">=</span><span class="fl">0.08</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>            head_length<span class="op">=</span><span class="fl">0.08</span>,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            fc<span class="op">=</span><span class="st">'k'</span>, ec<span class="op">=</span><span class="st">'k'</span>,</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>            length_includes_head<span class="op">=</span><span class="va">True</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    fig.supxlabel(<span class="st">'$x$'</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    fig.supylabel(<span class="st">'$</span><span class="er">\</span><span class="st">dot</span><span class="sc">{x}</span><span class="st">$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-supcritf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-supcritf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="abeb2dd7" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bifurcations_files/figure-html/cell-6-output-1.png" width="611" height="457" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-supcritf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5
</figcaption>
</figure>
</div>
<p>In <a href="#fig-supcritbfc" class="quarto-xref">Figure&nbsp;<span>3.6</span></a> we plot a bifurcation diagram for the supercritical pitchfork. Note that when <span class="math inline">\(r&lt;0\)</span> there is a single fixed point that is linearly stable. For <span class="math inline">\(r&gt;0\)</span> there are three fixed points.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">400</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed points</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> np.zeros_like(r)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>x_plus <span class="op">=</span> np.full_like(r, np.nan)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>x_minus <span class="op">=</span> np.full_like(r, np.nan)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> r <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>x_plus[mask] <span class="op">=</span> np.sqrt(r[mask])</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>x_minus[mask] <span class="op">=</span> <span class="op">-</span>np.sqrt(r[mask])</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># unstable branch x = 0 for r &gt; 0</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>ax.plot(r[r <span class="op">&gt;</span> <span class="dv">0</span>], x0[r <span class="op">&gt;</span> <span class="dv">0</span>], <span class="st">'k--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># stable branch x = 0 for r &lt; 0</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>ax.plot(r[r <span class="op">&lt;</span> <span class="dv">0</span>], x0[r <span class="op">&lt;</span> <span class="dv">0</span>], <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># stable branches ±sqrt(r)</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>ax.plot(r, x_plus, <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>ax.plot(r, x_minus, <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"$r$"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"$x*$"</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-supcritbfc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-supcritbfc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="39baba22" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bifurcations_files/figure-html/cell-7-output-1.png" width="565" height="468" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-supcritbfc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6
</figcaption>
</figure>
</div>
<p>With the app below you can explore how the value of the parameter value <span class="math inline">\(r\)</span> affects system dynamics for the supercritical pitchfork bifurcation.</p>
<p>The app computes solutions to <span class="math display">\[
\dot{x}=rx-x^3, \quad x(0)=x_0, \quad t \in[0,T].
\]</span></p>
<ol type="1">
<li>Show that in the case where <span class="math inline">\(r&gt;0\)</span> the initial conditions control which of the stable fixed points the system finds.</li>
</ol>
<pre class="shinylive-python" data-engine="python"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 800
#| label: fig-transcrit


from shiny import App, Inputs, Outputs, Session, render, ui
from shiny import reactive

import numpy as np
from pathlib import Path
import matplotlib.pyplot as plt
from scipy.integrate import odeint
from scipy.integrate import solve_ivp

app_ui = ui.page_fluid(
                 
    ui.input_slider(id="u0",label="x_0 (Init. Cond.)",min=-3.0,max=3.0,value=0.5,step=0.01),
    ui.input_slider(id="T",label="T (Time)",min=0.1,max=60.0,value=20.0,step=1.0),
    ui.input_slider(id="r",label="r",min=-2.0,max=2.0,value=0.1,step=0.1),
    ui.output_plot("plot"),

)

def server(input, output, session):
    @output
    @render.plot
    def plot():
        fig, ax = plt.subplots(3,1,figsize=(12, 4))
        #ax.set_ylim([-2, 2])
        #         
        r=float(input.r())
        u0=float(input.u0())
        T=int(input.T())
    
        
        # Define rhs of bfc ODE 
        def super_pitchfork_bfc_rhs(t,y,r):
          rhs=r*y-y**3
          return rhs
        def stop_event(t, y,r):
            return np.abs(y[0]-10)          # trigger when y[0] == 0

        
        def ODESol(rhs,y_0,T,r):
            #y=np.zeros_like(t,dtype=float)
            init_cond=y_0

            stop_event.terminal = True   # STOP integration
            stop_event.direction = 1   # only trigger when crossing downward

            sol1 = solve_ivp(rhs,t_span=(0, T),y0=[init_cond],
                events=stop_event,args=(r,)
            )
            return sol1
            
        # Define discretised t domain
        # define initial conditions
        init_cond=u0
        
        ax[0].set_xlabel('$t$')
        ax[0].set_ylabel('$x(t)$')

        plt.grid()
        
        # Compute numerical solution of ODEs
        sol1 = ODESol(super_pitchfork_bfc_rhs,init_cond,T,r)
        
        ax[0].plot(sol1.t,sol1.y[0])
        ax[0].set_xlabel('$t$')
        ax[0].set_ylabel('$x$')
        ax[0].set_ylim([-2.5,2.5])
        ax[0].set_title('Numerical solution')

        
        r_values = np.linspace(-2.0, 2.0, 1000)  # range of r values
        r_values2 = np.linspace(0.0, 2.0, 1000)  # range of r values

        
        x_1=np.zeros_like(r_values)
        x_2=np.sqrt(r_values2)

        ax[1].plot(r_values,x_1,'k')

        ax[1].plot(r_values2,x_2,'k--',r_values2,-x_2,'k--')

        ax[1].set_xlabel('$r$')
        ax[1].set_ylabel('$x^*$')
        ax[1].set_xlim([-3,3])
        ax[1].set_title('Bifurcation diagram')
        ax[1].plot([r,r],[-3,3],'--')

        
        x_plot=np.linspace(-3,3)
        f=super_pitchfork_bfc_rhs(0,x_plot,r)
        ax[2].plot(x_plot,f)
        ax[2].set_xlabel('$x$')
        ax[2].set_ylabel('$f$')
        ax[2].set_ylim([-2,2])
        ax[2].plot([u0,u0],[-2,2],'--')

        ax[2].set_title('Phase portrait')

        x_arrows = np.linspace(-1.8, 1.8, 6)
        f_arrows = r * x_arrows - x_arrows**3

        for xa, fa in zip(x_arrows, f_arrows):
            if abs(fa) &lt; 1e-3:
                continue
            direction = np.sign(fa)
            ax[2].arrow(
                xa, 0,
                0.12 * direction, 0,
                head_width=0.2,
                head_length=0.28,
                fc='k', ec='k',
                length_includes_head=True
            )
        
                
app = App(app_ui, server)</code></pre>
<p>An app for exploring behaviour of the supercritical pitchfork bifurcation.</p>
</section>
<section id="subcritical-pitchfork" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="subcritical-pitchfork"><span class="header-section-number">3.4.2</span> Subcritical pitchfork</h3>
<p><span class="math display">\[
\dot{x}=rx+x^3,
\]</span></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>x<span class="op">=</span>np.linspace(<span class="op">-</span><span class="fl">1.5</span>,<span class="fl">1.5</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>r_vec<span class="op">=</span>[<span class="op">-</span><span class="fl">1.0</span>,<span class="fl">0.0</span>,<span class="fl">1.0</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>fig,ax<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>ax.flatten()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,r_i <span class="kw">in</span> <span class="bu">enumerate</span>(r_vec):</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    f<span class="op">=</span>r_i<span class="op">*</span>x<span class="op">+</span>x<span class="op">**</span><span class="dv">3</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    ax[i].plot(x,f)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    r<span class="op">=</span>r_i</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>     <span class="co"># ---- fixed points ----</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    fixed_points <span class="op">=</span> [<span class="fl">0.0</span>]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> r <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        fixed_points <span class="op">+=</span> [np.sqrt(<span class="op">-</span>r), <span class="op">-</span>np.sqrt(<span class="op">-</span>r)]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x_fp <span class="kw">in</span> fixed_points:</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> r <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> x_fp<span class="op">**</span><span class="dv">2</span>   <span class="co"># derivative at fixed point</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df <span class="op">&lt;</span> <span class="dv">0</span>:   <span class="co"># stable</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            ax[i].plot(x_fp, <span class="dv">0</span>, <span class="st">'ko'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:        <span class="co"># unstable</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>            ax[i].plot(x_fp, <span class="dv">0</span>, <span class="st">'ko'</span>, markerfacecolor<span class="op">=</span><span class="st">'white'</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    ax[i].axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    ax[i].axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f"r = </span><span class="sc">{</span>r<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    ax[i].set_ylim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    x_arrows <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">1.8</span>, <span class="fl">1.8</span>, <span class="dv">6</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    f_arrows <span class="op">=</span> r <span class="op">*</span> x_arrows <span class="op">+</span> x_arrows<span class="op">**</span><span class="dv">3</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> xa, fa <span class="kw">in</span> <span class="bu">zip</span>(x_arrows, f_arrows):</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">abs</span>(fa) <span class="op">&lt;</span> <span class="fl">1e-3</span>:</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> np.sign(fa)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        ax[i].arrow(</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>            xa, <span class="dv">0</span>,</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.12</span> <span class="op">*</span> direction, <span class="dv">0</span>,</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>            head_width<span class="op">=</span><span class="fl">0.08</span>,</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>            head_length<span class="op">=</span><span class="fl">0.08</span>,</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>            fc<span class="op">=</span><span class="st">'k'</span>, ec<span class="op">=</span><span class="st">'k'</span>,</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>            length_includes_head<span class="op">=</span><span class="va">True</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    fig.supxlabel(<span class="st">'$x$'</span>)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    fig.supylabel(<span class="st">'$</span><span class="er">\</span><span class="st">dot</span><span class="sc">{x}</span><span class="st">$'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-subcritbfc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-subcritbfc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="b21b3105" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bifurcations_files/figure-html/cell-8-output-1.png" width="611" height="457" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-subcritbfc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.7
</figcaption>
</figure>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">400</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed points</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>x0 <span class="op">=</span> np.zeros_like(r)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>x_plus <span class="op">=</span> np.full_like(r, np.nan)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>x_minus <span class="op">=</span> np.full_like(r, np.nan)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> <span class="op">-</span>r <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>x_plus[mask] <span class="op">=</span> np.sqrt(<span class="op">-</span>r[mask])</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>x_minus[mask] <span class="op">=</span> <span class="op">-</span>np.sqrt(<span class="op">-</span>r[mask])</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># unstable branch x = 0 for r &gt; 0</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>ax.plot(r[r <span class="op">&gt;</span> <span class="dv">0</span>], x0[r <span class="op">&gt;</span> <span class="dv">0</span>], <span class="st">'k--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># stable branch x = 0 for r &lt; 0</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>ax.plot(r[r <span class="op">&lt;</span> <span class="dv">0</span>], x0[r <span class="op">&lt;</span> <span class="dv">0</span>], <span class="st">'k-'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># stable branches ±sqrt(r)</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>ax.plot(r, x_plus, <span class="st">'k--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>ax.plot(r, x_minus, <span class="st">'k--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, lw<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"$r$"</span>)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"$x*$"</span>)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-subcritf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-subcritf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="b7412bf2" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Bifurcations_files/figure-html/cell-9-output-1.png" width="565" height="468" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-subcritf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.8
</figcaption>
</figure>
</div>
<!--
## Application: the spruce budworm model
The spruce budworm is a destructive and widely distributed forest defoliator in North America. Massive outbreaks occur periodically and can destroy large quantities of valuable spruce and fir. To understand the outbreak behaviour and develop and management strategies, a series of mathematical models have been developed, beginning with @ludwig1978qualitative. The goal of the models is to explain the qualitative pattern of sudden outbreaks and then a sudden collapse.

### Model development
Letting $N(t)$ represent the population size at time $t$, it is assumed that budworm exhibits  logistic growth and is subject to  predation at rate $p(N)$.
 A governing ordinary differential equation is given by
$$
\frac{dN }{dt}= r_B N\left(1-\frac{N}{K_B}\right)-p(N),
$${#eq-sprucebudworm}
where 
$$
p(N) =\frac{B N^2}{A^2 +N^2},
$$
$r_B$ is the linear growth rate, $K_B$ is the carrying capacity, $B$ is the maximum rate of predation and $A$ is a measure of budworm population where predation switches on (specifically, $A$ represents the budworm density at which predation is half its maximum value).


It is informative to graph  the predation term
$$
p(N) =\frac{B N^2}{A^2 +N^2},
$$
and annotate the parameters $A$ and $B$.

There is a root at $N=0$.
In the limit $N\rightarrow \infty$, $p \rightarrow B$.
Note that $N=A$, $p=A/2$.
The derivative is
$$
p'(N)=\frac{2BN}{A^2+N^2} - \frac{2BN^3}{(A^2+N^2)^2} =  \frac{2BA^2N}{(A^2+N^2)^2}
$$
Thus there is a turning point at $N=0$ and $p'>0 \forall N>0$.


### Nondimensionalisation

Introducing the (as yet unspecified) dimensional scalings $\tilde{N}$ and $\tilde{T}$, the model is nondimensionalised as follows

$$
n=\frac{N}{\tilde{N}} \ \ \ \ \ \ \tau=\frac{t}{\tilde{T}}.
$$

Changing  variables in @eq-sprucebudworm yields

$$
\frac{\tilde{N}}{\tilde{T}}\frac{d n }{d\tau}= r_B \tilde{N}n\left(1-\frac{\tilde{N}n}{K_B}\right)-\frac{B\tilde{N}^2n^2}{A^2+\tilde{N}^2 n^2}.
$$

After some tidying

$$
\frac{dn }{d\tau}= r_B\tilde{T} n\left(1-\frac{\tilde{N}n}{K_B}\right)-\frac{B\tilde{N} \tilde{T}}{A^2}\frac{n^2}{1+\frac{\tilde{N}^2}{A^2}n^2}.
$$


A natural scale for cell density in the model is given by the parameter $A$, as it determines the density of budworm at which predation is half its maximal value. Hence we choose the scaling on the budworm density
$$
\tilde{N}=A.
$$ 
Similarly, a natural time scale for the model is given by  
$$
\tilde{T}=A/B.
$$


Substituting for $\tilde{N}$ and $\tilde{T}$ yields
$$
\frac{dn }{d\tau}= rn\left(1-\frac{n}{q}\right)-\frac{n^2}{1+n^2} = H(n),
$${#eq-budwormnondim}
where we define the nondimensional parameters
$$
r= \frac{r_B A}{B} \ \ \  \textrm{and} \ \ \  q=\frac{K_B}{A}.
$$

Note that @eq-budwormnondim has two nondimensional parameters and all variables are dimensionless.  See @fig-sprucebudworm-rhs for a plot of right-hand side of equation @eq-budwormnondim. What kind of behaviours do you expect to see from the model? 


:::

::: {#c23e7737 .cell execution_count=9}
``` {.python .cell-code code-fold="true"}
#| label: fig-sprucebudworm-rhs
#| fig-cap: "RHS of spr. budworm model"
import numpy as np
import matplotlib.pyplot as plt
import scipy
from scipy.integrate import odeint

N_max=1.1
N_0=0.1
q=12
r_1=0.22
r_2=0.42
r_3=0.72

n_vec=np.linspace(0,N_max,100)

def rhssprucebudworm_model(x,t,r,q):

  rhs=r*x*(1-x/q) - x**2/(1+x**2)
  return rhs
def rhssprucebudworm_model_f(x,t,r,q):

  f=r*x*(1-x/q) 
  return f  
def rhssprucebudworm_model_g(x,t,r,q):

  g=x**2/(1+x**2)
  return g  

rhs1=rhssprucebudworm_model(n_vec,0,r_1,q)
rhs2=rhssprucebudworm_model(n_vec,0,r_2,q)
rhs3=rhssprucebudworm_model(n_vec,0,r_3,q)

fig, ax = plt.subplots(1)

ax.plot(n_vec, rhs1,n_vec, rhs2,n_vec, rhs3)
plt.xlabel('$N$')
plt.ylabel('$H(N)$')
plt.legend(['r='+str(r_1),'r='+str(r_2),'r='+str(r_3)])
plt.grid(True)
plt.show()
```

::: {.cell-output .cell-output-display}
![](Bifurcations_files/figure-html/cell-10-output-1.png){width=601 height=429}
:::
:::


:::

### Numerical solutions
In @fig-sprucebudworm-numsol we plot some numerical solutions of @eq-budwormnondim at different values of the parameter $r$. 

Numerical solutions of @eq-budwormnondim  indicate that there is a single stable steady state when $r$ is both small and large but for intermediate values of $r$ there are two stable steady states. 

Our goal is to analyse the model and understand why different parameter values yield these strikingly different model behaviours.




:::

::: {#0acd54b6 .cell execution_count=10}
``` {.python .cell-code code-fold="true"}
#| label: fig-sprucebudworm-numsol
#| fig-cap: "Numerical solution of spr. budworm model"

# Define time
t = np.linspace(0, 100, 101)

# Numerically solve the ODE for differnet parameter values
sol1 = odeint(rhssprucebudworm_model, N_0, t, args=(r_1, q))
sol2 = odeint(rhssprucebudworm_model, N_0, t, args=(r_2, q))
sol3 = odeint(rhssprucebudworm_model, N_0, t, args=(r_3, q))


# plot results
fig, ax= plt.subplots()
ax.plot(t, sol1, 'b', label='r=' +str(r_1))
ax.plot(t, sol2, 'r', label='r='+str(r_2))
ax.plot(t, sol3, 'm', label='r='+str(r_3))

plt.legend(loc='best')
plt.xlabel('$t$')
plt.ylabel('$N$')

plt.grid()
plt.show()
```

::: {.cell-output .cell-output-display}
![](Bifurcations_files/figure-html/cell-11-output-1.png){width=585 height=429}
:::
:::


:::


### Steady state analysis
Letting $n^*$ represent steady states of @eq-budwormnondim yields
$$
rn^*(1-\frac{n^*}{q})- \frac{n^*{^2}}{1+n^*{^2}}=0.
$$
Hence either 
$$
n^*=0,
$$ 
or $n^*$ satisfies the cubic equation
$$
r\left(1-\frac{n^*}{q}\right)- \frac{n^*}{1+n^*{^2}}=0.
$$

Explicit solutions to such a cubic can be immediately written down but they are cumbersome to work with.  We proceed using a graphical/qualitative approach.

Define
$$
f(n^*)=r\left(1-\frac{n^*}{q}\right) \ \ \textrm{and} \ \ g(n^*)=\frac{n^*}{1+n^*{^2}}.
$${#eq-sprucebudwormfgn}

Roots occur for values of $n^*$ that satisfy $f=g$. 

In @fig-sprucebudworm-rhsfg (a) we fix the parameter $q=10$ and consider model behaviour as a function of the parameter $r$. 
When $r\gg1$ there is a nonzero steady-state corresponding to $n^*\gg 1$. 
When   $r\ll1$ there is a nonzero steady-state corresponding to $n^*\ll 1$. 
In the intermediate case there can be three intersection points.

We can use the curve sketching techniques form Tutorial Sheet 1 to sketch $f$ and $g$.

$f$ is linear.
There is  a root at $n^*=q$.
The derivative is $-r/q$.
$f(0)$=r.
$g$ has a unique root at $n^*=0$.
The derivative is
$$
g'=\frac{1-n{^*}^2}{(1+n^*)^2}.
$$
There is a turning point at $n^*=1$. Here $g=1/2$.
As $n^*\rightarrow \infty$, $g\rightarrow 0$.
$f'(0)=1$.

### Linear stability analysis

The linear stability of the model is determined by the quantity
$$
H'(n)=r(1-\frac{2n}{q})-\frac{2{n}}{1+{n}^2} +\frac{2{n}^3}{(1+{n}^2)^2}.
$$

Hence at the steady state $n^*=0$ 
$$
H'(0)=r
$$
and the steady state is linearly unstable.

Given the  nonzero steady states have not been calculated explicitly, we proceed using graphical analysis of stability. In @fig-sprucebudworm-rhsfg  (b) we plot the right-hand side of @eq-budwormnondim against $n$ and examine the cases of large, small and intermediate $r$ for a given value of $q$. 

When $r$ is both large and small the nonzero steady state is stable (the derivative at the roots is negative). 
In the case where three biologically relevant roots exist, the intermediate root is unstable.

:::

::: {#a9077234 .cell execution_count=11}
``` {.python .cell-code code-fold="true"}
#| label: fig-sprucebudworm-rhsfg
#| fig-cap: "RHS of spr. budworm model"
import numpy as np
import matplotlib.pyplot as plt
import scipy
from scipy.integrate import odeint

# Define initial condition
N_0=0.1

# Define model parameters
q=12
r_1=0.2
r_2=0.5
r_3=0.8

# Discretise n
N_max=13
n_vec=np.linspace(0,N_max,100)

# Function to compute f and g
def rhssprucebudworm_model_f(x,t,r,q):

  f=r*(1-x/q) 
  return f  
def rhssprucebudworm_model_g(x,t,r,q):

  g=x/(1+x**2)
  return g  

# Compute f for different values of r and g
f_1=rhssprucebudworm_model_f(n_vec,0,r_1,q)
f_2=rhssprucebudworm_model_f(n_vec,0,r_2,q)
f_3=rhssprucebudworm_model_f(n_vec,0,r_3,q)
g=rhssprucebudworm_model_g(n_vec,0,r_1,q)


# Compute H for different values of r
h_1=rhssprucebudworm_model(n_vec,0,r_1,q)
h_2=rhssprucebudworm_model(n_vec,0,r_2,q)
h_3=rhssprucebudworm_model(n_vec,0,r_3,q)


# Plot results
fig, ax = plt.subplots(1,2)

ax[0].plot(n_vec, f_1,n_vec, f_2,n_vec, f_3,n_vec,g)
ax[0].set_xlabel('$n$')
ax[0].set_ylabel('$f,g$')
ax[0].grid(True)
ax[0].legend(['r='+str(r_1),'r='+str(r_2),'r='+str(r_3)])
ax[1].plot(n_vec, h_1,n_vec, h_2,n_vec, h_3)
ax[1].set_xlabel('$n$')
ax[1].set_ylabel('$H$')
ax[1].grid(True)
ax[1].legend(['r='+str(r_1),'r='+str(r_2),'r='+str(r_3)])
plt.tight_layout()
plt.show()
```

::: {.cell-output .cell-output-display}
![](Bifurcations_files/figure-html/cell-12-output-1.png){width=659 height=468}
:::
:::


:::




### Bifurcation analysis
The goal is to identify boundaries of $rq$ parameter space where the stability changes occur and/or the number of steady states changes.

We can define points in $rq$ parameter space where bifurcations arise by seeking values of $n^*$ that satisfy
$$
f(n^*)= g(n^*) \ \ \ \  f'(n^*)= g'(n^*).
$$

The first of these equations yields
$$
  r(1-\frac{n^*}{q}) = \frac{n^*}{1+n{^*}^{2}},
$$ {#eq-rqeqn1}
and the latter yields
$$
 -\frac{r}{q}=\frac{1}{1+n{^*}^{2}}-\frac{2n{^*}^{2}}{(1+n{^*})^2} = \frac{1-n{^*}^{2}}{(1+n{^*}^{2})^2}.
$${#eq-rqeqn2}
  

Hence
$$
   \frac{r}{q}= \frac{n{^*}^{2}-1}{(1+n{^*}^{2})^2}.
$$

Substituting for $r/q$ in the first equation yields
$$
r-\frac{n{^*}^{2}-1}{(1+n{^*}^{2})^2}n^*=\frac{n^*}{1+n{^*}^{2}},
$$
which can be written in the form
$$
r=\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2}.
$$
Substituting for $r$ in @eq-rqeqn1 yields
$$
\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2}=\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2}\frac{n^*}{q}+\frac{n^*}{1+n{^*}^2}
$$
which, after some algebra, yields
$$
q=\frac{2n{^*}^3}{n{^*}^{2}-1}.
$$ {#eq-sprucebudwormqpara}
Hence a set of points that define bifurcations where three steady states transform to a single steady state are given in parametric form in $qr$ parameter space by
$$
\left(\frac{2n{^*}^3}{n{^*}^{2}-1},\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2}\right) \ \ \ \ \ \ \ n^*>1.
$$


:::

::: {#cell-fig-sprucebudworm-rq .cell execution_count=12}
``` {.python .cell-code code-fold="true"}
# Function to compute bifurcation values of r and q as a function of n_star
def Computerq(x):
  q_n_star=2*x**3/(x**2-1)
  r_n_star=2*x**3/(1+x**2)**2
  return  r_n_star,q_n_star

# Define different domains of n
n_s_1=np.linspace(1,np.sqrt(3),100)
n_s_2=np.linspace(np.sqrt(3),200,100)

# Compute r and q
r_1,q_1=Computerq(n_s_1)
r_2,q_2=Computerq(n_s_2)

# Plot results
fig, ax = plt.subplots(1)

ax.plot(q_1, r_1,q_2, r_2)
plt.xlabel('$q$')
plt.ylabel('$r$')
ax.set_xlim([0, 100])
plt.grid(True)

plt.show()
```

::: {.cell-output .cell-output-display}
![Bifurcations in the rq plane](Bifurcations_files/figure-html/fig-sprucebudworm-rq-output-1.png){#fig-sprucebudworm-rq width=602 height=429}
:::
:::


:::

By varying values of $n^*$ in @fig-sprucebudworm-rq we plot a region of instability. Note for example that $q\rightarrow \infty$ as $n^*\rightarrow 1$ and as  $n^*\rightarrow \infty$. Note also that in these limits $r$ must take the value 1/2 and 0, respectively.

We can show that the cusp in  @fig-sprucebudworm-rq
is given by
$$
\left(q,r\right)=\left(3^{\frac{3}{2}},\left(\frac{\sqrt{3}}{2}\right)^3\right).
$$

Note that $r$ is a decreasing function of $q$ for $1<n^*<\sqrt{3}$ but that $r$ is an increasing function of $n^*$ for $\sqrt{3}<n^*<\infty$. This can be shown by finding the turning points of $r$ w.r.t $n^*$, i.e.
Given that
$$
r=\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2},
$$
differentiation with respect to $n^*$ yields
$$
\frac{dr}{dn^*}=\frac{6{n^*}^2}{(1+n^*)^2} - \frac{8n{^*}^4}{(1+n^*)^3}.
$$
The turning point satisfies
$$
\frac{6{n^*}^2}{(1+n^*)^2} - \frac{8n{^*}^4}{(1+n^*)^3}=0
$$
Solving for $n^*$ yields
$$
6(1+{n^*}^2) - 8n{^*}^2=0 
$$
Hence
$$
  n^*=\sqrt{3}.
$$
Thus there is a turning point that minimises $r$ at $n^*=\sqrt{3}$.

Substitution for this value of $n^*$ yields
$$
\left(q,r\right)=\left(3^{\frac{3}{2}},\left(\frac{\sqrt{3}}{2}\right)^3\right).
$$
See @fig-sprucebudworm-rq.



### Hysteresis 

Finally, rearranging the steady-state equation 
$$
  r(1-\frac{n^*}{q}) = \frac{n^*}{1+n{^*}^{2}},
 $$
 we obtain
$$ 
   r = \frac{n^*}{(1+n{^*}^{2})(1-\frac{n^*}{q})}.
$$ {#eq-sprucebudwormrpara}

Considering $n^*<q$ we  compute $r$; plotting $n^*$ against $r$ yields the bifurcation curve presented in @fig-sprucebudworm-bfc. 


:::

::: {#cell-fig-sprucebudworm-bfc .cell execution_count=13}
``` {.python .cell-code code-fold="true"}
# Compute r as a function of n
def Computern(x,q):
  r=x/((1+x**2)*(1-x/q))
  return  r

# Define different domains of n for plotting 
q=12
n_s_1=np.linspace(1,np.sqrt(3),100)
n_s_2=np.linspace(np.sqrt(3),0.99*q,100)
n_s_3=np.linspace(0,np.sqrt(3),100)


# Evaluate r
r_1=Computern(n_s_1,q)
r_2=Computern(n_s_2,q)
r_3=Computern(n_s_3,q)


# Plote results
fig, ax = plt.subplots(1)

ax.plot(r_1, n_s_1,r_2, n_s_2,r_3,n_s_3)
plt.xlabel('$r$')
plt.ylabel('$n^*$')
ax.set_xlim([0, 2])
plt.grid(True)

plt.show()
```

::: {.cell-output .cell-output-display}
![Bifurcations in the rq plane](Bifurcations_files/figure-html/fig-sprucebudworm-bfc-output-1.png){#fig-sprucebudworm-bfc width=601 height=429}
:::
:::


:::

A system exhibiting hysteresis shows a response to an increases in a control parameter that is not exactly reversed when the parameter is decreased. We can show that the spruce budworm model exhibits hysteresis by considering the argument below.

Suppose $r$ is initially small ($r<r_1$). There is only one steady-state and any initial condition will converge towards it. 

 Suppose we increase the value of the parameter $r$. There will be a critical value of $r$ ($r=r_1$)where a second stable steady-state arises and the model enters the bistable regime, where there are two possible stable steady-states. Given the system system was originally in the first stable steady state, it will remain there. 

 Suppose we continue to increase $r$. Eventually we reach  critical value of $r$ ($r=r_2$) where the first stable steady state is lost and there is again only one stable steady-state. 

 Suppose we now decrease the parameter $r$ below the threshold $r=r_2$. The system again enters the bistable regime but as the second solution is stable, it remains the solution. 

 Suppose we continue to decrease $r$ until eventually $r<r_1$. We return to the case where the system has only a single stable steady state. 
 



## References

-->


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./1DFlows.html" class="pagination-link" aria-label="Flows on the line">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Flows on the line</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./PythonAppendix.html" class="pagination-link" aria-label="Python">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Python</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/dundeemath/MA32011/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>