{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"2D nonlinear systems\"\n",
        "format: html\n",
        "---\n",
        "\n",
        "## Introduction\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\dot{x}_1&=f_1(x_1,x_2)\\\\\n",
        "\\dot{x}_2&=f_2(x_1,x_2)\\\\\n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "In vector form\n",
        "$$\n",
        "\\dot{\\mathbf{x}}=\\mathbf{f}(\\mathbf{x})\n",
        "$$\n",
        "where $\\mathbf{x}=(x_1,x_2)^T$ and $\\mathbf{f}=(f_1,f_2)^T$.\n",
        "\n",
        "Here $\\mathbf{x}$ represents a point in the phase plane, $\\dot{\\mathbf{x}}$ represents the velocity. By flowing along the vector field, a phase point traces out a solution $\\mathbf{x}(t)$. As each point in the place can be an initial condition, the plane is filled with trajectories.\n",
        "\n",
        "## Phase portraits\n",
        "\n",
        "\n",
        "For nonlinear problems it is usually impossible to find trajectories analytically. Instead, our goal is to describe the qualitative behaviour of trajectories.  Some important features of phase portraits are:\n",
        "- fixed points\n",
        "- close orbits\n",
        "- behaviour of trajectories close to fixed points\n",
        "- the stability of any fixed points and closed orbits\n",
        "- the vector field\n",
        "- nullclines\n",
        "\n",
        "::: {#exm-    }\n",
        "\n",
        "PLot a phase portrait for the system:\n",
        "\\begin{aligned}\n",
        "\\dot{x}&=x+e^{-y}\\\\\n",
        "\\dot{y}&=-y\n",
        "\\end{aligned}\n",
        "\n",
        "Strategy:\n",
        "- fixed points and their linear stability\n",
        "- nullclines\n",
        "- derivative/vector field\n",
        "- sample trajectories\n",
        ":::\n",
        "\n",
        "\n",
        "\n",
        "## Existence, uniqueness and topological consequences\n",
        "\n",
        "::: {.Theorem}\n",
        "Consider the initial value problem\n",
        "$$\n",
        "\\dot{\\mathbf{x}}=\\mathbf{f}(\\mathbf{x}), \\quad \\mathbf{x}(0)=\\mathbf{x}_0,\n",
        "$$\n",
        " Suppose that $\\mathbf{f}$ is continuous and that all partial derivatives exist and are continuous in some open connected set $D\\subset \\mathbf R ^n$. For $\\mathbf{x}_0 \\in D$, the IVP has a unique solution in some time interval $t \\in (\\tau,\\tau)$.\n",
        "$$\n",
        ":::\n",
        "\n",
        "::: {.Corollary}\n",
        "\n",
        "Different trajectories never intersect.\n",
        ":::\n",
        "\n",
        "::: {.Corollary}\n",
        "\n",
        "In 2D, trajectories initialised inside a closed orbit remain trapped inside it for all time.\n",
        ":::\n",
        "\n",
        "\n",
        "## Fixed points and linearisation\n",
        "\n",
        "### Steady states \n",
        "\n",
        "\n",
        " $(u^*,v^*)$ is defined to be a steady state of @eq-twovariablfegen if \n",
        "\n",
        "$$\n",
        "f(u^*,v^*)=g(u^*,v^*)=0.\n",
        "$$\n",
        "\n",
        "Hence, by definition, the time derivatives of $u(t)$ and $v(t)$ are both zero at $(u^*,v^*)$. As was the case for single species models, steady states are obtained by solving algebraic equations.\n",
        "\n",
        "### Linear stability analysis\n",
        "Suppose that $(u^*,v^*)$ is a steady state of equations @eq-twovariablfegen.\n",
        "\n",
        "We consider a change of dependent variables such that\n",
        "\n",
        "$$\n",
        "u(t)=u^*+ \\hat{u}(t)  \\  \\  \\textrm{and} \\ \\ v(t)=v^*+\\hat{v}(t),\n",
        "$$\n",
        "\n",
        "where $\\hat{u}(t)$ and $\\hat{v}(t)$ are perturbations about the steady state.\n",
        "\n",
        "Rewriting equation @eq-twovariablfegen in the transformed variables yields\n",
        " \n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\frac{d\\hat{u}}{dt}&=f(u^*+\\hat{u},v^*+\\hat{v}),  \\nonumber \\\\\n",
        "\\frac{d\\hat{v}}{dt}&=g(u^*+\\hat{u},v^*+\\hat{v}).\n",
        "\\end{aligned}\n",
        "$$ {#eq-twovariablfegentrans}\n",
        "\n",
        "Making Taylor expansions about $(u^*,v^*)$ yields the linearised equations\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\frac{d\\hat{u}}{dt}=\\frac{\\partial f}{\\partial u}_{|(u^*,v^*)} \\hat{u} +  \\frac{\\partial f}{\\partial v}_{|(u^*,v^*)}  \\hat{v} + h.o.t, \\nonumber\\\\\n",
        "\\frac{d\\hat{v}}{dt}=\\frac{\\partial g}{\\partial u}_{|(u^*,v^*)}  \\hat{u} +  \\frac{\\partial g}{\\partial v}_{|(u^*,v^*)}  \\hat{v} + h.o.t. \\nonumber\n",
        "\\end{aligned}\n",
        "$$ {#eq-twovariablfegenlin}\n",
        "\n",
        "In matrix form\n",
        "$$\n",
        "\\mathbf{w}=\\left\n",
        "(\\begin{array}{r}\n",
        "\\hat{u} \\\\ \n",
        "\\hat{v} \n",
        "\\end{array}\\right),\n",
        "$$\n",
        "\n",
        "yields the system of ODEs \n",
        "\n",
        "$$\n",
        "\\frac{d \\mathbf{w}}{dt}= A \\mathbf{w},\n",
        "+ h.o.t\n",
        "$$ {#eq-linearsystem2d}\n",
        "\n",
        "where the matrix $A$, known as the Jacobian matrix,  takes the form\n",
        "\n",
        "$$\n",
        "A=\\left(\\begin{array}{rr}\n",
        "\\frac{\\partial f}{\\partial u}&\\frac{\\partial f}{\\partial v} \\\\ \\frac{\\partial g}{\\partial u}&\\frac{\\partial g}{\\partial v} \\end{array}\\right)_{(u^*,v^*)}. \\qquad\n",
        "$$\n",
        "\n",
        "In the neighbourhood of fixed points, we expect the higher order terms to become vanishingly small. If we are willing to neglect the higher order terms then close to the fixed points we can describe the dynamics the dynamics using the linearised system\n",
        "$$\n",
        "\\frac{d \\mathbf{w}}{dt}= A \\mathbf{w},\n",
        "$$ {#eq-linearsystem2dhmm}\n",
        "\n",
        "## Neglecting nonlinear terms?\n",
        "\n",
        "\n",
        "::: {.Definition}\n",
        "\n",
        "A fixed point of an $n^{th}$ order system is hyperbolic if all the eigenvalues of the linear system lie off the imaginary axis (i.e. $\\Re (\\lambda_i)\\neq 0 \\forall i).   \n",
        "\n",
        ":::\n",
        "\n",
        "::: {.Theorem}\n",
        "Hartman-Grobman \n",
        "\n",
        "The local phase portrait near a hyperbolic fixed point is topologically equivalent (i.e. homeomorphic) to the phase portrait of the linearisation.\n",
        "\n",
        ":::\n",
        "\n",
        "\n",
        "::: {.Definition}\n",
        "Structural stability\n",
        "\n",
        "A phase portrait is structurally stable if its topology cannot be changed by an arbitrarily small change to the vector field.    \n",
        "\n",
        ":::\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "::: {#exm-    }\n",
        "Consider the system\n",
        "\\begin{aligned}\n",
        "\\dot{x} & =-y+ax(x^2+y^2)\\\\\n",
        "\\dot{y} & =x+ay(x^2+y^2)\n",
        "\\end{aligned}\n",
        "where $a\\in\\Re$. Show that the lienarised system incorrectly predicts that the origin is a centre. By transforming to polar coordinates show that the system is actually either a stable/unspiral for $a\\neq 0$.\n",
        "\n",
        ":::\n",
        "\n",
        " \n",
        "\n",
        "\n",
        "\n",
        "## Competition\n",
        "\n",
        "In models of competition, two or more species compete for the same resource or in some way inhibit each other's growth. Letting $N_1(t)$ and $N_2(t)$ represent the population density of two species, we consider the ODEs\n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\frac{d N_1}{dt} &= r_1N_1\\left(1-\\frac{N_1}{K_1}-b_{12}\\frac{N_2}{K_1}\\right), \\nonumber \\\\\n",
        "\\frac{d N_2}{dt} &= r_2N_2\\left(1-\\frac{N_2}{K_2}-b_{21}\\frac{N_1}{K_2}\\right), \n",
        "\\end{aligned}\n",
        "$$\n",
        "where $r_1$, $r_2$, $K_1$ and $K_2$ are positive constants. As before, the $r's$ are linear growth rates and the $K$'s are carrying capacities. The parameters  $b_{12}$ and $b_{21}$ measure the competitive effect of $N_2$ on $N_1$ and $N_1$ on $N_2$, respectively.\n",
        "\n",
        "### Nondimensionalisation\n",
        "\n",
        "After nondimensionalising using the change of variables\n",
        "\n",
        "$$\n",
        "n_1=\\frac{N_1}{K_1} \\ \\ n_2=\\frac{N_2}{K_2} \\ \\ \\tau=\\frac{t}{\\frac{1}{r_1}},\n",
        "$$\n",
        "\n",
        "we obtain the equations\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\frac{d n_1}{d\\tau} &= n_1\\left(1- n_1-a_{12}n_2\\right) = f(n_1,n_2), \\nonumber \\\\\n",
        "\\frac{d n_2}{d\\tau} &= \\rho n_2\\left(1-n_2-a_{21}n_1\\right) =g(n_1,n_2),\n",
        "\\end{aligned}\n",
        "$${#eq-competitionnondim}\n",
        "\n",
        "where\n",
        "\n",
        "$$\n",
        "\\rho=\\frac{r_2}{r_1}, \\ \\ \\ a_{12}=b_{12}\\frac{K_2}{K_1}, \\ \\ \\  a_{21}=b_{21}\\frac{K_1}{K_2}. \n",
        "$$\n",
        "\n",
        "### Steady states\n",
        "\n",
        "The steady states of @eq-competitionnondim are identified in the usual manner, i.e. by seeking $({n_1}^*,{n_2}^*)$  such that \n",
        "\n",
        "$$\n",
        "f({n_1}^*,{n_2}^*)=g({n_1}^*,{n_2}^*)=0.\n",
        "$$\n",
        "\n",
        "\n",
        "The steady state equations are\n",
        "$$\n",
        " {n_1}^*\\left(1- {n_1}^*-a_{12}{n_2}^*\\right)=0 \\ \\ \\ \\ {n_2}^*\\left(1-{n_2}^*-a_{21}{n_1}^*\\right)=0.\n",
        "$$\n",
        "The first equation has solution\n",
        "$$\n",
        "n_1^*=0\n",
        "$$\n",
        "or\n",
        "$$\n",
        "\\left(1- {n_1}^*-a_{12}{n_2}^*\\right) \\implies n_2=\\frac{1}{a_{12}}(1-n_1^*).\n",
        "$$\n",
        "Consider $n_1^*=0$. Substitution in the second equation yields\n",
        "$$\n",
        " {n_2}^*\\left(1-{n_2}^*\\right)=0.\n",
        " $$\n",
        " Hence either $n_2^*=0$ or $n_2^*=1$. Hence two steady  states are $(0,0)$ and $(0,1).$\n",
        "\n",
        "\n",
        "Now consider $n_2^*=\\frac{1}{a_{12}}(1-n_1^*)$ with $n_1^*\\neq0$.\n",
        "\n",
        "Substitution in the second steady state equation yields\n",
        "$$\n",
        "\\frac{1}{a_{12}}(1-n_1^*) \\left(1- \\frac{1}{a_{12}}(1-n_1^*) -a_{21}{n_1}^*\\right)\n",
        "$$\n",
        "Hence either $n_1^*=1$ or\n",
        "$$\n",
        "\\left(1- \\frac{1}{a_{12}}(1-n_1^*) -a_{21}{n_1}^*\\right)=0 \\implies n_1^*=\\frac{1-a_{12}}{1-a_{12}a_{21}}.\n",
        "$$\n",
        "In the case where $n_1^*=1$, we find that $n_2^*=0$. Hence the steady state is (1,0).\n",
        "\n",
        "In the case where \n",
        "$$\n",
        "n_1^*=\\frac{1-a_{12}}{1-a_{12}a_{21}}\n",
        "$$\n",
        "we find that \n",
        "$$\n",
        "n_2^*=\\frac{1-a_{21}}{1-a_{12}a_{21}}\n",
        "$$\n",
        "Hence the steady state is\n",
        "$$\n",
        "\\left(\\frac{1-a_{12}}{1-a_{12}a_{21}},\\frac{1-a_{21}}{1-a_{12}a_{21}}\\right).\n",
        "$$\n",
        "\n",
        "### Nullclines\n",
        "\n",
        "The nullclines for @eq-competitionnondim are straight lines given by\n",
        " \n",
        "$$\n",
        " n_1=0 \\ \\ \\ \\ \\ n_2=\\frac{1-n_1}{a_{12}}, \n",
        "$$\n",
        " \n",
        "and\n",
        "\n",
        "$$ \n",
        " n_2=0 \\ \\  \\ \\  \\ n_2= 1-a_{21}n_1.\n",
        "$$\n",
        " \n",
        "Note that the steady states $(0,0)$, $(1,0)$ and $(0,1)$ are always biologically relevant (i.e. independently of the parameter values for $a_{12}$ and $a_{21}$). \n",
        " \n",
        "However, the coexistence steady state is  only biologically relevant if the nullclines intersect in the positive quadrant and this occurs only in certain regions of the model's parameter space. \n",
        " \n",
        "In the  cases where $a_{12},a_{21}<1$ and $a_{12},a_{21}>1$ there is a coexistence steady state (i.e. the nullclines intersect in the positive quadrant). \n",
        " \n",
        "However, if $a_{21}<1$ and $a_{12}>1$ or  $a_{12}<1$ and $a_{21}>1$ there is not a biologically relevant, coexistence steady state (i.e. the nullclines do not intersect in the positive quadrant).  \n",
        " \n",
        "Hence there are are four qualitatively different types of solution to consider.\n",
        "\n",
        "### Linear stability\n",
        "\n",
        "The linear stability of the different steady states is determined by calculating the Jacobian matrix \n",
        "\n",
        "$$\n",
        "A=\\left(\\begin{array}{rr}\n",
        "\\frac{\\partial f}{\\partial n_1}&\\frac{\\partial f}{\\partial n_2} \\\\ \\frac{\\partial g}{\\partial n_1 }&\\frac{\\partial g}{\\partial n_2} \\end{array}\\right)_{({n_1}^*,{n_2}^*)} = \\left(\\begin{array}{rr}\n",
        "1-2n_1 -a_{12}n_2&-a_{12}n_1 \\\\ -\\rho a_{21}n_2 &\\rho(1-2n_2-a_{21}n_1)\\end{array}\\right)_{({n_1}^*,{n_2}^*)}. \n",
        "$$\n",
        "\n",
        "At (0,0)\n",
        "\n",
        "$$\n",
        "A=\\left(\\begin{array}{rr}\n",
        "1& 0 \\\\ 0 & \\rho\\end{array}\\right). \n",
        "$$\n",
        "\n",
        "Hence the eigenvalues of the Jacobian are $1$ and $\\rho$. As $\\rho>0$, the origin is therefore an unstable node (there are two real positive eigenvalues).\n",
        "\n",
        "At (1,0)\n",
        "\n",
        "$$\n",
        "A=\\left(\\begin{array}{rr}\n",
        "-1& -a_{12} \\\\ 0 & \\rho(1-a_{21})\\end{array}\\right). \n",
        "$$\n",
        "\n",
        "The trace and determinant are given by\n",
        "\n",
        "$$\n",
        "\\det{A}=\\rho  (a_{21}-1)\\ \\ \\ \\textrm{and} \\ \\ \\ \\mathrm{tr}{A}=-1+\\rho(1-a_{21}).\n",
        "$$\n",
        "\n",
        "Hence if $a_{21}<1$, $\\det{A}<0$ and (1,0) is a saddle point and thus unstable (see @fig-tdplane).\n",
        " \n",
        "If  $a_{21}>1$,  $\\det{A}>0$ and $\\mathrm{tr}{A}<0$. Hence  (1,0) is a stable node. \n",
        "  \n",
        "Hence the parameter $a_{21}$, which describes how strongly Population 1 inhibits the growth rate of Population 2, determines whether or not the steady state representing extinction of Population 2 but not Population 1 is stable or not.\n",
        "\n",
        "At (0,1)\n",
        "\n",
        "$$\n",
        "A=\\left(\\begin{array}{rr}\n",
        "1-a_{12}& 0\\\\  -\\rho a_{21} & -\\rho \\end{array}\\right). \n",
        "$$\n",
        "\n",
        "In this case if $a_{12}<1$, $\\det{A}<0$ and (0,1) is a saddle point. If  $a_{12}>1$,  $\\det{A}>0$ and $\\mathrm{tr}{A}<0$ and (0,1) is a stable node. Hence the parameter $a_{12}$, which describes how strongly Population 2 inhibits the growth rate of Population 1, determines whether or not the steady state representing extinction of Population 1 but not Population 2 is stable or not.\n",
        "\n",
        "At the coexistence steady state, recall the steady state is\n",
        "\n",
        "$$\n",
        "\\left(\\frac{1-a_{12}}{1-a_{12}a_{21}},\\frac{1-a_{21}}{1-a_{12}a_{21}}\\right).\n",
        "$$\n",
        " Note that this steady state is only biologically relevant in the cases $a_{21}<1, a_{12}<1$ or $a_{21}>1, a_{12}>1$.  Evaluating the Jacobian yields\n",
        "$$\n",
        "A=\\frac{1}{1-a_{12}a_{21}}\\left(\\begin{array}{rr}\n",
        "a_{12}-1  & -a_{12}(1-a_{12})\\\\ -\\rho a_{21}(1-a_{21}) &\\rho(a_{21}-1)\\end{array}\\right). \n",
        "$$\n",
        "\n",
        "The determinant and trace of the Jacobian are given by\n",
        "\n",
        "$$\n",
        "\\begin{aligned}\n",
        "\\det{A}&=\\rho\\left((a_{12}-1)(a_{21}-1)-a_{12}a_{21}(1-a_{12})(1-a_{21})\\right)\\frac{1}{(1-a_{12}a_{21})^2}, \\nonumber \\\\\n",
        "&= \\rho\\frac{(a_{12}-1)(a_{21}-1)}{(1-a_{12}a_{21})},\n",
        "\\end{aligned}\n",
        "$$\n",
        "\n",
        "and\n",
        "\n",
        "$$\n",
        "\\mathrm{tr}{A}=\\left(a_{12}-1+\\rho(a_{21}-1)\\right) \\frac{1}{1-a_{12}a_{21}},\n",
        "$$\n",
        "respectively.\n",
        "\n",
        "Let's firstly consider the case where $a_{21}<1$ and $a_{21}<1$.  This implies that $a_{21}-1<0$ and $a_{12}-1<0$, hence evaluating the signs of the different products yields\n",
        "\n",
        "$$\n",
        "\\det{A} = \\rho(-)(-)(+)>0 \n",
        "$$\n",
        "and\n",
        "$$\n",
        "\\mathrm{tr}{A}= \\rho(-) + (-)<0.\n",
        "$$\n",
        "\n",
        "Therefore the coexistence steady state is a stable node or spiral.\n",
        "\n",
        "\n",
        "In the case where $a_{21}>1$ and $a_{12}>1$\n",
        "\n",
        "$$\n",
        "\\det{A} = \\rho(+)(+)(-)<0 .\n",
        "$$\n",
        "\n",
        "Hence the coexistence steady state is a saddle.\n",
        "\n",
        "### Phase portrait\n",
        "See @fig-comp-numsol-phplane for phase portraits of three of the four cases that we have considered. It is expected that you can sketch phase portraits. Key details to consider are the steady states and their linear stability. You should also sketch the nullclines and depict the sign of the derivatives in the phase plane on either side of the nullclines. You should also sketch one or more sample trajectories."
      ],
      "id": "27fdf7a8"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-compete-numsol\n",
        "#| fig-cap: Numerical solutions of competition model\n",
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "import scipy\n",
        "from scipy.integrate import odeint\n",
        "\n",
        "# Define model parameters\n",
        "rho=1.5\n",
        "a_12=0.5\n",
        "a_21=0.5\n",
        "\n",
        "# Define rhs of ODEs\n",
        "def rhs_comp_model(x,t):\n",
        "  rhs=np.zeros_like(x)\n",
        "  n_1=x[0]\n",
        "  n_2=x[1]\n",
        "  dn_1_dt=n_1*(1-n_1)-a_12*n_1*n_2\n",
        "  dn_2_dt=rho*(n_2*(1-n_2)-a_21*n_1*n_2)\n",
        "  rhs[0]=dn_1_dt\n",
        "  rhs[1]=dn_2_dt\n",
        "  return rhs\n",
        "\n",
        "# Define discretised time domain\n",
        "t = np.linspace(0, 10, 1000)\n",
        "\n",
        "# Define IC\n",
        "init_cond=[0.5,0.5]\n",
        "\n",
        "# Numerically integrate ODes\n",
        "sol1 = odeint(rhs_comp_model, init_cond,t)\n",
        "\n",
        "# PLot results\n",
        "n_1=sol1[:,0]\n",
        "n_2=sol1[:,1]\n",
        "\n",
        "fig, ax=plt.subplots()\n",
        "ax.plot(t, n_1, 'b',t,n_2,'r')\n",
        "\n",
        "ax.legend(['$n_1$','$n_2$'],loc='best')\n",
        "ax.set_xlabel('t')\n",
        "plt.grid()\n",
        "plt.show()"
      ],
      "id": "fig-compete-numsol",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| label: fig-comp-numsol-phplane\n",
        "#| fig-cap: Numerical solution of the competition model\n",
        "\n",
        "# Phase plane for the competition model \n",
        "import numpy as np\n",
        "import matplotlib.pyplot as plt\n",
        "import scipy\n",
        "from scipy.integrate import odeint\n",
        "\n",
        "\n",
        "# Discretise n domain\n",
        "n_1_vec=np.linspace(0,5,100)\n",
        "\n",
        "\n",
        "# COmpute different elements of the phase plane\n",
        "def ComputeCompetitionSol(a_12,a_21,n_1_vec):\n",
        "    t = np.linspace(0, 10, 1000)\n",
        "\n",
        "    # Different ICs for integrating trajectories\n",
        "    init_cond1=[0.75,0.75]\n",
        "    init_cond2=[0.15,0.15]\n",
        "    init_cond3=[2.5,0.5]\n",
        "\n",
        "    # Integrate the ODEs\n",
        "    alpha=2.0\n",
        "    sol1 = odeint(rhs_comp_model, init_cond1,t)\n",
        "    sol2 = odeint(rhs_comp_model, init_cond2,t)\n",
        "    sol3 = odeint(rhs_comp_model, init_cond3,t)\n",
        "\n",
        "    # determine which case we are in\n",
        "    num_steady_states=3\n",
        "    fourth_ss_condition= ((a_12<1) & (a_21<1)) | ((a_12>1) & (a_21>1))\n",
        "    if fourth_ss_condition==True:\n",
        "        num_steady_states=4\n",
        "\n",
        "    # Compute the steady dstates\n",
        "    ss=np.zeros((num_steady_states,2),dtype=float)\n",
        "    ss[0,:]=[0,0]\n",
        "    ss[1,:]=[1,0]\n",
        "    ss[2,:]=[0,1]\n",
        "    if fourth_ss_condition==True:\n",
        "        ss[3,:]=[(1-a_12)/(1-a_12*a_21),(1-a_21)/(1-a_12*a_21)]\n",
        "\n",
        "\n",
        "    # Compute the nullclines\n",
        "    n1_ncline_1_n_1=[0,0]    \n",
        "    n1_ncline_1_n_2=[0,5]   \n",
        "    n1_ncline_2_n_2=1/a_12*(1-n_1_vec)\n",
        "    n2_ncline_1_n_1=[0,5]    \n",
        "    n2_ncline_1_n_2=[0,0]   \n",
        "    n2_ncline_2_n_2=1-a_21*(n_1_vec)\n",
        "\n",
        "    # Return the various computed QUANTITIES\n",
        "    return sol1,sol2,sol3,ss,n1_ncline_1_n_1,n1_ncline_1_n_2,n1_ncline_2_n_2,n2_ncline_1_n_1,n2_ncline_1_n_2,n2_ncline_2_n_2\n",
        "\n",
        "# Compute quantities\n",
        "a_12=0.5\n",
        "a_21=0.4\n",
        "sol1,sol2,sol3,ss, n1_ncline_1_n_1,n1_ncline_1_n_2,n1_ncline_2_n_2,n2_ncline_1_n_1,n2_ncline_1_n_2,n2_ncline_2_n_2=ComputeCompetitionSol(a_12,a_21,n_1_vec)\n",
        "\n",
        "# PLot phase plane\n",
        "fig, ax = plt.subplots(1,2)\n",
        "ax[0].plot(n1_ncline_1_n_1,n1_ncline_1_n_2,'k--')\n",
        "ax[0].plot(n_1_vec,n1_ncline_2_n_2,'k--')\n",
        "ax[0].plot(n2_ncline_1_n_1,n2_ncline_1_n_2,'r--')\n",
        "ax[0].plot(n_1_vec,n2_ncline_2_n_2,'r--')\n",
        "\n",
        "ax[0].plot(sol1[:,0],sol1[:,1],sol2[:,0],sol2[:,1],sol3[:,0],sol3[:,1])\n",
        "ax[0].plot(ss[:,0],ss[:,1],'k*')\n",
        "ax[0].set_xlabel('$n_1$')\n",
        "ax[0].set_ylabel('$n_2$')\n",
        "\n",
        "ax[0].set_xlim([-0.05,1.5])\n",
        "ax[0].set_ylim([-0.05,1.5])\n",
        "\n",
        "# Compoute quantitied for different parameters\n",
        "a_12=1.5\n",
        "a_21=0.4\n",
        "sol1,sol2,sol3,ss, n1_ncline_1_n_1,n1_ncline_1_n_2,n1_ncline_2_n_2,n2_ncline_1_n_1,n2_ncline_1_n_2,n2_ncline_2_n_2=ComputeCompetitionSol(a_12,a_21,n_1_vec)\n",
        "\n",
        "# PLot phase plane\n",
        "ax[1].plot(n1_ncline_1_n_1,n1_ncline_1_n_2,'k--')\n",
        "ax[1].plot(n_1_vec,n1_ncline_2_n_2,'k--')\n",
        "ax[1].plot(n2_ncline_1_n_1,n2_ncline_1_n_2,'r--')\n",
        "ax[1].plot(n_1_vec,n2_ncline_2_n_2,'r--')\n",
        "\n",
        "ax[1].plot(sol1[:,0],sol1[:,1],sol2[:,0],sol2[:,1],sol3[:,0],sol3[:,1])\n",
        "ax[1].plot(ss[:,0],ss[:,1],'k*')\n",
        "ax[1].set_xlabel('$n_1$')\n",
        "ax[1].set_ylabel('$n_2$')\n",
        "\n",
        "ax[1].set_xlim([-0.05,1.5])\n",
        "ax[1].set_ylim([-0.05,1.5])\n",
        "\n",
        "plt.tight_layout()\n",
        "plt.grid()\n",
        "plt.show()"
      ],
      "id": "fig-comp-numsol-phplane",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "### Insight\n",
        "\n",
        "The model therefore has four qualitatively different behaviours that are described as follows:\n",
        "Consider the case where $a_{21}>1$. This represents the case of Population 1 strongly competing with Population 2.\n",
        "\n",
        "*  If $a_{12}>1$,  Population 2 also strongly competes with Population 1. In this case, there are four biologically relevant steady states, two of which are stable (1,0) and (0,1). The coexistence steady state is a saddle and thus unstable. \n",
        "The model is bistable and the initial conditions determine whether solutions end up at (1,0) or (0,1) (see @fig-comp-numsol-phplane). \n",
        "The biological interpretation of this solution is that one species will always win and completely outcompete the other. Even if the two populations are equal ($K_1=K_2$ and $a_{21}=a_{12}>1$), one species will always win and the other will become extinct.\n",
        "* If $a_{12}<1$, Population 2 weakly competes with Population 1. There is no coexistence steady state and the only stable steady state is (1,0). Hence Population 1 always wins and Population 2 always becomes extinct.\n",
        "\n",
        "Now consider the case where $a_{21}<1$. This represents the case of Population 1 weakly competing with Population 2.\n",
        "\n",
        "* If $a_{12}>1$,  Population 2 strongly competes with Population 1. There is nonexistence steady state and the only stable steady state is (0,1). Hence Population 2 always wins and Population 1 always becomes extinct.\n",
        "* If $a_{12}<1$, Population 2 also weakly competes with Population 1. The coexistence steady state is stable and the  steady states (1,0) and (0,1) are unstable. \n",
        "\n",
        "\n",
        "::: {#exm-    }\n",
        "\n",
        "Consider a particle of mass 1 moving in double well potential\n",
        "$$\n",
        "V(x)=-\\frac{1}{2}x^2+\\frac{1}{4}x^4.\n",
        "$$\n",
        "Find and classify all the fixed points for the system. Plot the phase portrait and provide an interpretatio n for the results.\n",
        ":::\n",
        "\n",
        "\n",
        "## References"
      ],
      "id": "78248242"
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "/Users/pmurray/Library/Python/3.9/share/jupyter/kernels/python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}